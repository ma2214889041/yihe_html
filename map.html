<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>高德地图定位示例</title>
  <script src="https://webapi.amap.com/maps?v=1.4.15&key=36ad54204561f8044ed21fb739f5abe4"></script>
  <style>
    #container {
      width: 100%;
      height: 90vh;
    }
    #confirmButton {
      width: 100%;
      height: 10vh;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 20px;
    }
    #confirmButton:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <button id="confirmButton" disabled>确认</button>
  <script>
    var map = new AMap.Map('container', {
      resizeEnable: true,
      center: [116.397428, 39.90923],
      zoom: 13
    });

    var currentLocation = null;

    // 使用浏览器定位
    map.plugin('AMap.Geolocation', function() {
      var geolocation = new AMap.Geolocation({
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0,
        convert: true,
        showButton: true,
        buttonPosition: 'RB',
        buttonOffset: new AMap.Pixel(10, 20),
        showMarker: true,
        showCircle: true,
        panToLocation: true,
        zoomToAccuracy: true
      });
      map.addControl(geolocation);
      geolocation.getCurrentPosition();
      AMap.event.addListener(geolocation, 'complete', onComplete); // 返回定位信息
      AMap.event.addListener(geolocation, 'error', onError); // 返回定位出错信息
    });

    // 定位成功信息处理
    function onComplete(data) {
      currentLocation = {
        longitude: data.position.getLng(),
        latitude: data.position.getLat()
      };
      document.getElementById('confirmButton').disabled = false;
    }

    // 定位失败信息处理
    function onError(error) {
      alert('定位失败，请重试');
    }

    // 点击确认按钮发送位置信息
    document.getElementById('confirmButton').addEventListener('click', function() {
      if (currentLocation) {
        this.textContent = '确认中...';
        this.disabled = true;

        fetch('https://play.svix.com/in/e_fV75v65uaQ4MxeOtPf2k1EQ9y9d/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(currentLocation)
        })
        .then(response => {
          if (response.status === 204) {
            this.textContent = '确认成功';
          } else {
            throw new Error('网络响应不正常');
          }
        })
        .catch((error) => {
          console.error('网络请求失败:', error);
          this.textContent = '确认失败，请重试';
          this.disabled = false;
        });
      }
    });
  </script>
</body>
</html>
